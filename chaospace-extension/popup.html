<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <title>CHAOSPACE 转存助手</title>
    <link rel="stylesheet" href="popup.css" />
  </head>
  <body class="popup-theme">
    <main class="popup-shell">
      <header class="popup-header" id="popup-header">
        <div class="popup-header-art is-empty" id="popup-header-art" aria-hidden="true"></div>
        <div class="popup-header-content">
          <div class="popup-header-topline">
            <span class="popup-assistant-badge">🚀 CHAOSPACE 转存助手</span>
            <div class="popup-header-actions">
              <button id="theme-toggle" type="button" class="popup-ghost-btn">切换浅色</button>
              <button id="refresh-btn" type="button" class="popup-ghost-btn">刷新</button>
            </div>
          </div>
          <h1 id="page-title" class="popup-show-title">等待选择剧集</h1>
          <p id="page-info" class="popup-show-subtitle">未检测到 CHAOSPACE 页面</p>
        </div>
      </header>

      <section class="popup-columns">
        <div class="popup-column popup-column-left">
          <div class="popup-section-heading">
            <div class="popup-section-title" id="items-title"></div>
            <div class="popup-section-caption" id="selection-summary"></div>
          </div>
          <div class="popup-toolbar">
            <div class="popup-sort-group">
              <label class="popup-sort-label">
                <span>排序</span>
                <select id="sort-key">
                  <option value="page">默认顺序</option>
                  <option value="title">标题</option>
                </select>
              </label>
              <button id="sort-order" type="button" class="popup-order-btn">正序</button>
            </div>
            <div class="popup-select-group">
              <button id="select-all" type="button">全选</button>
              <button id="select-invert" type="button">反选</button>
              <button id="select-new" type="button">仅选新增</button>
            </div>
          </div>
          <div id="items-container" class="popup-items"></div>
        </div>

        <div class="popup-column popup-column-right">
          <div class="popup-card popup-path-card">
            <div class="popup-card-title">📁 转存目录</div>
            <div class="popup-card-body">
              <div id="preset-list" class="popup-chip-list"></div>
              <div class="popup-input-row">
                <input id="base-dir" type="text" placeholder="/视频/番剧" />
                <button id="add-preset" type="button">收藏路径</button>
              </div>
              <label class="popup-checkbox">
                <input id="use-title-subdir" type="checkbox" checked />
                <span>为资源创建标题子目录</span>
              </label>
              <div id="path-preview" class="popup-path-preview"></div>
            </div>
          </div>

          <div class="popup-card popup-history-card" id="history-card">
            <div class="popup-card-header">
              <div class="popup-card-title">🔖 转存历史</div>
              <div class="popup-card-actions">
                <button id="history-expand" type="button" class="popup-ghost-btn">展开</button>
              </div>
            </div>
            <div id="history-empty" class="popup-history-empty">还没有转存记录</div>
            <div id="history-list" class="popup-history-list"></div>
            <div id="history-panel" class="popup-history-panel" aria-hidden="true">
              <div class="popup-history-tabs" id="history-tabs" role="tablist">
                <button type="button" class="popup-history-tab is-active" data-filter="all">全部</button>
                <button type="button" class="popup-history-tab" data-filter="series">剧集</button>
                <button type="button" class="popup-history-tab" data-filter="ongoing">未完结</button>
                <button type="button" class="popup-history-tab" data-filter="completed">已完结</button>
                <button type="button" class="popup-history-tab" data-filter="movie">电影</button>
              </div>
              <div class="popup-history-panel-toolbar">
                <div class="popup-history-panel-left">
                  <label class="popup-checkbox popup-history-select-all">
                    <input id="history-select-all" type="checkbox" />
                    <span>全选当前筛选结果</span>
                  </label>
                  <div id="history-selection-count" class="popup-history-selection-count">已选 0 项</div>
                </div>
                <div class="popup-history-panel-right">
                  <button id="history-batch-check" type="button" class="popup-primary-btn" disabled>批量检测更新</button>
                  <button id="history-delete-selected" type="button" class="popup-ghost-btn" disabled>删除选中</button>
                  <button id="history-clear" type="button" class="popup-ghost-btn">清空历史</button>
                </div>
              </div>
              <div id="history-panel-list" class="popup-history-panel-list"></div>
              <div id="history-panel-empty" class="popup-history-panel-empty">当前筛选没有记录</div>
              <div id="history-panel-footnote" class="popup-history-panel-footnote">
                仅支持对未完结的剧集进行检测；批量检测会按顺序逐条执行，并自动控制访问速率。
              </div>
            </div>
          </div>

          <div class="popup-card popup-status-card">
            <div class="popup-card-title">🧠 转存状态</div>
            <div id="status-line" class="popup-status-line"></div>
            <div class="popup-log-header">
              <span>📜 日志</span>
              <button id="toggle-log" type="button" class="popup-log-toggle">展开</button>
            </div>
            <div id="log-container" class="popup-log-container">
              <ul id="log-list" class="popup-log-list"></ul>
            </div>
            <div id="result-summary" class="popup-result-summary is-empty"></div>
          </div>

          <div class="popup-card popup-transfer-card">
            <button id="transfer-btn" type="button" class="popup-transfer-button">
              <span class="popup-spinner" id="transfer-spinner" aria-hidden="true"></span>
              <span id="transfer-label">转存选中资源</span>
              <span class="popup-button-icon" aria-hidden="true">🚀</span>
            </button>
          </div>

          <div id="messages" class="popup-messages"></div>
        </div>
      </section>
    </main>

    <script src="popup.js" type="module"></script>
  </body>
</html>
