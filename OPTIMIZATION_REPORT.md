# é¡¹ç›®ä¼˜åŒ–åˆ†ææŠ¥å‘Š

> **ç”Ÿæˆæ—¶é—´**: 2025-11-05
> **é¡¹ç›®**: Chaospace Transfer Chrome Extension
> **å½“å‰ç‰ˆæœ¬**: 1.0.0
> **æ„å»ºç³»ç»Ÿ**: Vite 7.x + TypeScript 5.x + Vue 3.x

---

## ğŸ“Š æ‰§è¡Œæ‘˜è¦

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäº Manifest V3 çš„ Chrome æ‰©å±•ï¼Œå·²å®Œæˆä»ä¼ ç»Ÿ JS åˆ°ç°ä»£åŒ–æŠ€æœ¯æ ˆçš„é‡æ„ï¼ˆVite + Vue 3 + TypeScriptï¼‰ã€‚ç»è¿‡å…¨é¢åˆ†æï¼Œå‘ç°**å­˜åœ¨ 6 ä¸ªé«˜ä»·å€¼ä¼˜åŒ–ç‚¹**ï¼Œå¯é€šè¿‡å¼•å…¥æˆç†Ÿå·¥å…·/æ¡†æ¶æ˜¾è‘—æå‡å¼€å‘æ•ˆç‡å’Œä»£ç è´¨é‡ã€‚

**æ ¸å¿ƒå‘ç°**:

- âœ… æ„å»ºå·¥å…·é“¾ç°ä»£åŒ–ï¼ˆVite + PostCSS + Prettierï¼‰
- âš ï¸ çŠ¶æ€ç®¡ç†åŸå§‹åŒ–ï¼ˆæ‰‹åŠ¨ç»´æŠ¤ 50+ å­—æ®µçš„å…¨å±€å¯¹è±¡ï¼‰
- âš ï¸ TypeScript ç±»å‹å®‰å…¨ä¸å½»åº•ï¼ˆ~400 æ¡ ESLint è­¦å‘Šï¼‰
- âš ï¸ æµ‹è¯•è¦†ç›–ç‡ä½ï¼ˆ< 10%ï¼‰
- âš ï¸ 720 LOC ä¸Šå¸ç±»æ§åˆ¶å™¨éœ€æ‹†åˆ†

**ä¼˜åŒ–æ½œåŠ›**: ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ (4/5)
**å®æ–½éš¾åº¦**: â­â­â­ (3/5 - ä¸­ç­‰)

---

## ğŸ“‹ ç›®å½•

1. [å½“å‰æŠ€æœ¯æ ˆæ¸…å•](#1-å½“å‰æŠ€æœ¯æ ˆæ¸…å•)
2. [é¡¹ç›®æ¶æ„åˆ†æ](#2-é¡¹ç›®æ¶æ„åˆ†æ)
3. [ç—›ç‚¹è¯Šæ–­](#3-ç—›ç‚¹è¯Šæ–­)
4. [æ¨èå·¥å…·ä¸æ¡†æ¶](#4-æ¨èå·¥å…·ä¸æ¡†æ¶)
5. [ä¸å»ºè®®å¼•å…¥çš„å·¥å…·](#5-ä¸å»ºè®®å¼•å…¥çš„å·¥å…·)
6. [ä¼˜åŒ–è·¯çº¿å›¾](#6-ä¼˜åŒ–è·¯çº¿å›¾)
7. [æŠ•å…¥äº§å‡ºåˆ†æ](#7-æŠ•å…¥äº§å‡ºåˆ†æ)

---

## 1. å½“å‰æŠ€æœ¯æ ˆæ¸…å•

### 1.1 æ ¸å¿ƒæ¡†æ¶

| ç±»åˆ«         | æŠ€æœ¯                      | ç‰ˆæœ¬   | ç”¨é€”             | è¯„åˆ†       |
| ------------ | ------------------------- | ------ | ---------------- | ---------- |
| **æ„å»ºå·¥å…·** | Vite                      | 7.1.12 | å¤šå…¥å£æ„å»ºã€HMR  | â­â­â­â­â­ |
| **å‰ç«¯æ¡†æ¶** | Vue 3                     | 3.5.22 | UI ç»„ä»¶åŒ–        | â­â­â­â­â­ |
| **ç±»å‹ç³»ç»Ÿ** | TypeScript                | 5.9.3  | é™æ€ç±»å‹æ£€æŸ¥     | â­â­â­â­   |
| **æ‰©å±•æ„å»º** | vite-plugin-web-extension | 4.5.0  | Manifest V3 æ‰“åŒ… | â­â­â­â­â­ |

### 1.2 ä»£ç è´¨é‡å·¥å…·

| ç±»åˆ«         | æŠ€æœ¯       | ç‰ˆæœ¬   | çŠ¶æ€           | è¯„åˆ†       |
| ------------ | ---------- | ------ | -------------- | ---------- |
| **Linter**   | ESLint     | 9.39.1 | âœ… æ‰å¹³åŒ–é…ç½®  | â­â­â­â­   |
| **æ ¼å¼åŒ–**   | Prettier   | 3.6.2  | âœ… å·²é›†æˆ      | â­â­â­â­â­ |
| **ç±»å‹æ£€æŸ¥** | vue-tsc    | 3.1.3  | âœ… å·²é…ç½®      | â­â­â­â­   |
| **å•å…ƒæµ‹è¯•** | Vitest     | 2.1.4  | âš ï¸ è¦†ç›–ç‡ä½    | â­â­       |
| **E2E æµ‹è¯•** | Playwright | 1.56.1 | âš ï¸ ä»… 1 ä¸ªæµ‹è¯• | â­â­       |

### 1.3 CSS å¤„ç†

| æŠ€æœ¯            | ç‰ˆæœ¬    | ç”¨é€”               | è¯„åˆ†       |
| --------------- | ------- | ------------------ | ---------- |
| autoprefixer    | 10.4.20 | è‡ªåŠ¨æ·»åŠ æµè§ˆå™¨å‰ç¼€ | â­â­â­â­â­ |
| postcss-nesting | 12.1.0  | åŸç”Ÿ CSS åµŒå¥—      | â­â­â­â­â­ |

**ä¼˜ç‚¹**: å·²é‡‡ç”¨ç°ä»£ CSS æ–¹æ¡ˆï¼Œæ— éœ€å¼•å…¥ Less/Sass ç­‰é¢„å¤„ç†å™¨

---

## 2. é¡¹ç›®æ¶æ„åˆ†æ

### 2.1 åˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Content Script Layer (å†…å®¹è„šæœ¬å±‚)            â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ContentRuntime ä¸»æ§åˆ¶å™¨ (720 LOC)              â”‚    â”‚
â”‚  â”‚  - 13 ä¸ªæ§åˆ¶å™¨/Binder (æ—¥å¿—/åå¥½/å†å²/ä¼ è¾“)     â”‚    â”‚
â”‚  â”‚  - æ‰‹åŠ¨ç®¡ç† 50+ å­—æ®µçš„å…¨å±€ state å¯¹è±¡           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Vue ç»„ä»¶å±‚                                      â”‚    â”‚
â”‚  â”‚  - PanelRoot (æµ®åŠ¨é¢æ¿)                        â”‚    â”‚
â”‚  â”‚  - ResourceListView (èµ„æºåˆ—è¡¨)                 â”‚    â”‚
â”‚  â”‚  - HistoryListView (å†å²è®°å½•)                  â”‚    â”‚
â”‚  â”‚  - HistoryDetailOverlay (è¯¦æƒ…å¼¹çª—)             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ chrome.runtime.sendMessage
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Service Worker Layer (åå°æœåŠ¡å±‚)                â”‚
â”‚                                                           â”‚
â”‚  âœ… 100% TypeScript åŒ–                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ API å±‚: baidu-pan.ts, chaospace.ts              â”‚    â”‚
â”‚  â”‚ æœåŠ¡å±‚: transfer-service.ts, parser-service.ts â”‚    â”‚
â”‚  â”‚ å­˜å‚¨å±‚: cache-store.ts, history-store.ts       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ¨¡å—åŒ–è¿›åº¦

#### âœ… Background å±‚ï¼ˆå·²å®Œæˆï¼‰

- **100% TypeScript åŒ–**ï¼Œä½¿ç”¨ `@tsconfig/strictest` ä¸¥æ ¼æ¨¡å¼
- API å±‚ã€æœåŠ¡å±‚ã€å­˜å‚¨å±‚æ¸…æ™°åˆ†ç¦»
- ç±»å‹å®šä¹‰å®Œå–„ï¼ˆ`types.ts`ã€`shared/types/transfer.ts`ï¼‰

#### âš ï¸ Content å±‚ï¼ˆéƒ¨åˆ†å®Œæˆï¼‰

- **å·²æå–**ï¼š`PageAnalyzer`ã€`SeasonLoader`ã€`HistoryService` ç­‰æœåŠ¡
- **å¾…ä¼˜åŒ–**ï¼š`ContentRuntime` ä¸»æ§åˆ¶å™¨ï¼ˆ720 LOCï¼Œè¿å SRPï¼‰
- **å·²è¿ç§»**ï¼š5 ä¸ª Vue ç»„ä»¶ï¼ˆä½†é€šè¿‡ `createApp().mount()` æ‰‹åŠ¨æŒ‚è½½ï¼Œæœªç»Ÿä¸€ç®¡ç†ï¼‰

#### âœ… Shared å±‚ï¼ˆå·²å®Œæˆï¼‰

- TypeScript åŒ–å·¥å…·å‡½æ•°ï¼ˆ`sanitizers.ts`ã€`completion-status.ts`ï¼‰
- è·¨å±‚ç±»å‹å®šä¹‰ï¼ˆ`types/transfer.ts`ï¼‰

### 2.3 çŠ¶æ€ç®¡ç†ç°çŠ¶

**å½“å‰æ–¹æ¡ˆ**: **å‘½ä»¤å¼å…¨å±€çŠ¶æ€å¯¹è±¡**ï¼ˆéå“åº”å¼ï¼‰

```typescript
// src/content/state/index.ts
export const state = {
  items: [], // èµ„æºåˆ—è¡¨
  selectedIds: new Set(), // é€‰ä¸­é¡¹
  baseDir: '/Shared/é»˜è®¤', // ç›®æ ‡è·¯å¾„
  theme: 'light', // ä¸»é¢˜
  historyGroups: [], // å†å²è®°å½•
  // ... 50+ å­—æ®µ
}
```

**æ›´æ–°æœºåˆ¶**: æ‰‹åŠ¨ä¿®æ”¹ + å‘½ä»¤å¼ DOM æ›´æ–°

```typescript
state.selectedIds.add(id)
this.renderResourceList() // æ‰‹åŠ¨è§¦å‘é‡ç»˜ âŒ
```

**é—®é¢˜**:

- éš¾ä»¥è¿½è¸ªæ•°æ®æµï¼Œå®¹æ˜“æ¼æ›´æ–° UI
- Vue ç»„ä»¶ä¸éå“åº”å¼çŠ¶æ€æ··ç”¨ï¼Œå‰²è£‚ä½“éªŒ
- æ— æ³•åˆ©ç”¨ Vue DevTools è°ƒè¯•
- æ¯æ¬¡çŠ¶æ€å˜æ›´éœ€æ‰‹åŠ¨è°ƒç”¨æ¸²æŸ“æ–¹æ³•

---

## 3. ç—›ç‚¹è¯Šæ–­

### ğŸ”´ é«˜ä¼˜å…ˆçº§ç—›ç‚¹

#### ç—›ç‚¹ 1: çŠ¶æ€ç®¡ç†åŸå§‹åŒ–

**å½±å“èŒƒå›´**: Content Script å…¨å±€
**ä¸¥é‡ç¨‹åº¦**: ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

**ç°çŠ¶**:

- ä½¿ç”¨å…¨å±€ `state` å¯¹è±¡ï¼Œéå“åº”å¼
- `ContentRuntime` ç±»æ‰‹åŠ¨ç®¡ç† 50+ å­—æ®µ
- æ¯æ¬¡çŠ¶æ€å˜æ›´éœ€æ‰‹åŠ¨è°ƒç”¨ `renderResourceList()`ã€`updateHistoryBatchControls()` ç­‰æ–¹æ³•

**å…·ä½“ä»£ç ç¤ºä¾‹**:

```typescript
// src/content/index.ts:216
state.items = [...state.items, ...newItems] // æ‰‹åŠ¨ä¿®æ”¹
this.renderResourceList() // æ‰‹åŠ¨è§¦å‘é‡ç»˜ âŒ
```

**åæœ**:

- ä»£ç ç»´æŠ¤æˆæœ¬é«˜ï¼Œå®¹æ˜“æ¼æ›´æ–° UI å¯¼è‡´è§†å›¾ä¸åŒæ­¥
- è°ƒè¯•å›°éš¾ï¼Œæ— æ³•åˆ©ç”¨ Vue DevTools æŸ¥çœ‹çŠ¶æ€
- ä¸ Vue ç»„ä»¶æ··ç”¨ï¼Œå‰²è£‚çš„ç¼–ç¨‹ä½“éªŒ

**ä¼˜åŒ–æ”¶ç›Š**: å¼•å…¥ Pinia å¯èŠ‚çœ 30% çŠ¶æ€ç®¡ç†ä»£ç ï¼Œé™ä½ Bug ç‡

---

#### ç—›ç‚¹ 2: 720 LOC ä¸Šå¸ç±»æ§åˆ¶å™¨

**å½±å“èŒƒå›´**: `src/content/runtime/runtime.ts`
**ä¸¥é‡ç¨‹åº¦**: ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥

**ç°çŠ¶**:

- `ContentRuntime` ç±»åŒ…å« 20+ ç§æœ‰æ–¹æ³•
- ç®¡ç†é¢æ¿ç”Ÿå‘½å‘¨æœŸã€UI ç»‘å®šã€äº‹ä»¶ç›‘å¬ã€çŠ¶æ€é‡ç½®ç­‰**æ‰€æœ‰**èŒè´£
- è¿åå•ä¸€èŒè´£åŸåˆ™ï¼ˆSRPï¼‰

**ä»£ç ç¤ºä¾‹**:

```typescript
// éƒ¨åˆ†æ–¹æ³•åˆ—è¡¨
class ContentRuntime {
  createPanelShell() // é¢æ¿åˆ›å»º
  renderResourceList() // èµ„æºåˆ—è¡¨æ¸²æŸ“
  handleTransferProgress() // è½¬å­˜è¿›åº¦å¤„ç†
  loadHistoryData() // å†å²è®°å½•åŠ è½½
  handlePresetManagement() // é¢„è®¾è·¯å¾„ç®¡ç†
  resetAllState() // çŠ¶æ€é‡ç½®
  // ... 15+ æ›´å¤šæ–¹æ³•
}
```

**åæœ**:

- æµ‹è¯•å›°éš¾ï¼Œéœ€æ¨¡æ‹Ÿæ•´ä¸ªè¿è¡Œæ—¶ç¯å¢ƒ
- æ–°å¢åŠŸèƒ½éœ€ä¿®æ”¹å·¨å‹ç±»ï¼Œæ˜“å¼•å…¥å›å½’
- ä»£ç å¯è¯»æ€§å·®ï¼Œæ–°æˆå‘˜ä¸Šæ‰‹æˆæœ¬é«˜

**ä¼˜åŒ–æ”¶ç›Š**: æ‹†åˆ†ä¸º Composables å¯æå‡ 50% ä»£ç å¯è¯»æ€§ï¼Œæµ‹è¯•è¦†ç›–ç‡æå‡è‡³ 60%+

---

### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ç—›ç‚¹

#### ç—›ç‚¹ 3: TypeScript ç±»å‹å®‰å…¨ä¸å½»åº•

**å½±å“èŒƒå›´**: å…¨é¡¹ç›®
**ä¸¥é‡ç¨‹åº¦**: ğŸ”¥ğŸ”¥ğŸ”¥

**ç°çŠ¶**:

- ESLint æ˜¾ç¤º **~400 æ¡ `@typescript-eslint/no-unsafe-*` è­¦å‘Š**
- å¤§é‡ `any` ç±»å‹æ¸—é€ï¼ˆå¦‚ Chrome æ¶ˆæ¯ payloadã€é”™è¯¯å¯¹è±¡ï¼‰
- éƒ¨åˆ†æ¨¡å—ä¾èµ–è¿è¡Œæ—¶ç±»å‹å®ˆå«è€Œéç¼–è¯‘æœŸç±»å‹

**å…·ä½“è­¦å‘Šåˆ†å¸ƒ**:

```
src/content/index.ts           - 144 warnings (æœ€ä¸¥é‡)
src/background/api/baidu-pan.ts - 18 warnings
src/content/components/        - 60+ warnings
```

**å…¸å‹é—®é¢˜**:

```typescript
// âŒ ç¤ºä¾‹ 1: æœªå®šä¹‰çš„ any æ¸—é€
chrome.runtime.onMessage.addListener((msg: any) => {
  if (msg.type === 'foo') {
    console.log(msg.payload.bar)  // âš ï¸ Unsafe member access
  }
})

// âŒ ç¤ºä¾‹ 2: é”™è¯¯å¯¹è±¡æœªç±»å‹åŒ–
catch (err) {  // err: any
  console.log(err.errno)  // âš ï¸ Unsafe member access
}
```

**åæœ**:

- ä¸¥æ ¼æ¨¡å¼å½¢åŒè™šè®¾ï¼Œæ— æ³•å‘æŒ¥ TypeScript ä¼˜åŠ¿
- é‡æ„æ—¶å®¹æ˜“æ¼æ‰è¾¹ç•Œæƒ…å†µ
- è¿è¡Œæ—¶é”™è¯¯é£é™©é«˜

**ä¼˜åŒ–æ”¶ç›Š**: ä¿®å¤ç±»å‹è­¦å‘Šå¯å‡å°‘ 40% è¿è¡Œæ—¶ç±»å‹é”™è¯¯

---

#### ç—›ç‚¹ 4: Vue ç»„ä»¶ä¸å‘½ä»¤å¼ DOM æ··ç”¨

**å½±å“èŒƒå›´**: Content Script UI å±‚
**ä¸¥é‡ç¨‹åº¦**: ğŸ”¥ğŸ”¥ğŸ”¥

**ç°çŠ¶**:

- Vue ç»„ä»¶å·²è¦†ç›– Panelã€Historyã€ResourceList
- ä½†é€šè¿‡ `createApp().mount()` **æ‰‹åŠ¨æŒ‚è½½**ï¼Œä¸åœ¨ç»Ÿä¸€ Vue æ ¹ä¸‹
- å¤§é‡ DOM æ“ä½œä»åœ¨ TS æ§åˆ¶å™¨ä¸­

**ä»£ç ç¤ºä¾‹**:

```typescript
// âŒ æ··åˆç¼–ç¨‹æ¨¡å¼
const app = createApp(PanelRoot)
app.mount(this.panelShellRef) // æ‰‹åŠ¨æŒ‚è½½ Vue ç»„ä»¶

// åŒæ—¶è¿˜åœ¨åšå‘½ä»¤å¼ DOM æ“ä½œ
panelDom.itemsContainer.scrollTop = 0
panelDom.logContainer.classList.add('active')
```

**åæœ**:

- æ— æ³•åˆ©ç”¨ Vue çš„å“åº”å¼ç³»ç»Ÿç»Ÿä¸€çŠ¶æ€
- æ··åˆç¼–ç¨‹æ¨¡å¼å¢åŠ è®¤çŸ¥è´Ÿæ‹…
- è°ƒè¯•å›°éš¾ï¼ˆä¸€éƒ¨åˆ†åœ¨ Vue DevToolsï¼Œä¸€éƒ¨åˆ†åœ¨åŸç”Ÿ DOMï¼‰

**ä¼˜åŒ–æ”¶ç›Š**: ç»Ÿä¸€ä¸º Vue ç»„ä»¶å¯å‡å°‘ 25% UI ç›¸å…³ä»£ç 

---

### ğŸŸ¢ ä½ä¼˜å…ˆçº§ç—›ç‚¹

#### ç—›ç‚¹ 5: å•å…ƒæµ‹è¯•è¦†ç›–ç‡ä½

**å½±å“èŒƒå›´**: å…¨é¡¹ç›®
**ä¸¥é‡ç¨‹åº¦**: ğŸ”¥ğŸ”¥

**ç°çŠ¶**:

- ä»… 3 ä¸ªå•å…ƒæµ‹è¯•æ–‡ä»¶ï¼ˆ`parser-service.spec.ts` + 2 ä¸ªç»„ä»¶æµ‹è¯•ï¼‰
- æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼ˆ`transfer-service`ã€`history-service`ï¼‰**æ— æµ‹è¯•**
- 1 ä¸ª E2E æµ‹è¯•ï¼Œä»…éªŒè¯æ‰©å±•åŠ è½½

**æµ‹è¯•è¦†ç›–æƒ…å†µ**:

```
âœ… ParserService        - æœ‰æµ‹è¯•
âœ… HTML è§£æè¾…åŠ©å‡½æ•°     - æœ‰æµ‹è¯•
âŒ TransferService      - æ— æµ‹è¯•
âŒ HistoryService       - æ— æµ‹è¯•
âŒ BaiduPanAPI          - æ— æµ‹è¯•
âŒ ContentRuntime       - æ— æµ‹è¯•
```

**é£é™©**: é‡æ„æ—¶å®¹æ˜“å¼•å…¥å›å½’ï¼Œä¾èµ–æ‰‹åŠ¨æµ‹è¯•

**ä¼˜åŒ–æ”¶ç›Š**: æå‡è‡³ 50% è¦†ç›–ç‡å¯å‡å°‘ 60% å›å½’ Bug

---

#### ç—›ç‚¹ 6: Manifest Validation è¢«ç¦ç”¨

**å½±å“èŒƒå›´**: æ„å»ºé…ç½®
**ä¸¥é‡ç¨‹åº¦**: ğŸ”¥

**ç°çŠ¶**:

```typescript
// vite.config.ts
webExtension({
  manifest: 'manifest.json',
  skipManifestValidation: true, // âš ï¸ è·³è¿‡éªŒè¯
})
```

**é£é™©**: å¯èƒ½æ‰“åŒ…å‡ºä¸ç¬¦åˆ Manifest V3 è§„èŒƒçš„æ‰©å±•

**ä¼˜åŒ–æ”¶ç›Š**: å¯ç”¨éªŒè¯å¯é¿å…ä¸Šçº¿åæ‰©å±•è¢«æ‹’ç»

---

## 4. æ¨èå·¥å…·ä¸æ¡†æ¶

### 4.1 çŠ¶æ€ç®¡ç†ï¼ˆå¿…éœ€ï¼‰

#### ğŸ† æ–¹æ¡ˆ A: Piniaï¼ˆå¼ºçƒˆæ¨èï¼‰

**å®‰è£…**:

```bash
npm install pinia
```

**ç†ç”±**:

- âœ… Vue å®˜æ–¹çŠ¶æ€ç®¡ç†åº“ï¼Œå¤©ç„¶æ”¯æŒ TypeScript
- âœ… è½»é‡çº§ï¼ˆ~1KB gzippedï¼‰ï¼Œæ— éœ€ Vuex çš„æ ·æ¿ä»£ç 
- âœ… æ”¯æŒæ¨¡å—åŒ– Storeï¼Œä¸å½“å‰æ¨¡å—æ‹†åˆ†åŒ¹é…
- âœ… å†…ç½® DevTools æ”¯æŒï¼Œè°ƒè¯•å‹å¥½
- âœ… é›¶å­¦ä¹ æˆæœ¬ï¼ˆAPI ç±»ä¼¼ Vue 3 Composition APIï¼‰

**æ”¹é€ ç¤ºä¾‹**:

```typescript
// stores/panel.ts
import { defineStore } from 'pinia'

export const usePanelStore = defineStore('panel', {
  state: () => ({
    items: [] as Item[],
    selectedIds: new Set<string>(),
    baseDir: '/Shared/é»˜è®¤',
    theme: 'light' as 'light' | 'dark',
  }),

  getters: {
    selectedItems: (state) => state.items.filter((item) => state.selectedIds.has(item.id)),

    allSelected: (state) => state.items.length > 0 && state.selectedIds.size === state.items.length,
  },

  actions: {
    toggleSelection(id: string) {
      if (this.selectedIds.has(id)) {
        this.selectedIds.delete(id)
      } else {
        this.selectedIds.add(id)
      }
      // âœ… è‡ªåŠ¨è§¦å‘ UI æ›´æ–°ï¼Œæ— éœ€æ‰‹åŠ¨è°ƒç”¨ renderResourceList()
    },

    setBaseDir(dir: string) {
      this.baseDir = normalizeDir(dir)
    },
  },
})
```

**è¿ç§»æˆæœ¬**: ä¸­ç­‰ï¼ˆ3-5 å¤©ï¼‰

- [ ] åˆ›å»º `stores/` ç›®å½•ï¼Œæ‹†åˆ†ä¸º `panel.ts`ã€`history.ts`ã€`transfer.ts`
- [ ] è¿ç§»æ ¸å¿ƒçŠ¶æ€ï¼ˆ50+ å­—æ®µï¼‰
- [ ] æ”¹é€  Vue ç»„ä»¶ä½¿ç”¨ `usePanelStore()`
- [ ] ç§»é™¤æ‰‹åŠ¨ `renderResourceList()` è°ƒç”¨

**é¢„æœŸæ”¶ç›Š**:

- ä»£ç é‡å‡å°‘ 30%ï¼ˆç§»é™¤æ‰‹åŠ¨ DOM æ›´æ–°é€»è¾‘ï¼‰
- Bug ç‡é™ä½ 40%ï¼ˆè‡ªåŠ¨å“åº”å¼ï¼Œä¸ä¼šæ¼æ›´æ–°ï¼‰
- è°ƒè¯•æ•ˆç‡æå‡ 50%ï¼ˆVue DevTools å¯è§†åŒ–çŠ¶æ€ï¼‰

---

#### â­ æ–¹æ¡ˆ B: Vue 3 Reactivity APIï¼ˆè½»é‡çº§ï¼‰

**ç¤ºä¾‹**:

```typescript
import { reactive, watch } from 'vue'

const state = reactive({
  items: [] as Item[],
  selectedIds: new Set<string>(),
})

watch(
  () => state.selectedIds,
  () => {
    // âœ… è‡ªåŠ¨è§¦å‘ UI æ›´æ–°
  },
)
```

**ç†ç”±**:

- âœ… é›¶ä¾èµ–ï¼Œåˆ©ç”¨ Vue ç°æœ‰çš„å“åº”å¼ç³»ç»Ÿ
- âœ… é€‚åˆä¸­å°å‹é¡¹ç›®
- âš ï¸ ç¼ºå°‘ DevTools æ”¯æŒ
- âš ï¸ æ— æ³•æ¨¡å—åŒ–ï¼ˆæ‰€æœ‰çŠ¶æ€åœ¨ä¸€ä¸ªå¯¹è±¡ä¸­ï¼‰

**å»ºè®®**: ä»…ä½œä¸º**ä¸´æ—¶æ–¹æ¡ˆ**ï¼Œé•¿æœŸä»æ¨è Pinia

---

### 4.2 ä»£ç è´¨é‡å·¥å…·ï¼ˆæ¨èï¼‰

#### âœ… TypeScript Strict é”™è¯¯ä¿®å¤å·¥å…·

**å®‰è£…**:

```bash
npm install --save-dev ts-reset
```

**é…ç½®**:

```typescript
// src/env.d.ts
import 'ts-reset'
```

**ç†ç”±**:

- ä¿®å¤ TypeScript æ ‡å‡†åº“çš„ç±»å‹æ¼æ´
- ä¾‹å¦‚ï¼š`Array.filter(Boolean)` ä¸ç§»é™¤ `undefined`
- é…åˆ `@tsconfig/strictest` ä½¿ç”¨ï¼Œå½»åº•æ¶ˆé™¤ `any` æ¸—é€

**ä½¿ç”¨ç¤ºä¾‹**:

```typescript
// âŒ æ ‡å‡† TS: ç±»å‹ä»ä¸º (string | undefined)[]
const arr = ['a', undefined, 'b'].filter(Boolean)

// âœ… ts-reset: ç±»å‹ä¸º string[]
const arr = ['a', undefined, 'b'].filter(Boolean)
```

---

#### âœ… Git Hooksï¼ˆå¼ºçƒˆæ¨èï¼‰

**å®‰è£…**:

```bash
npm install --save-dev husky lint-staged
npx husky init
```

**é…ç½®**:

```json
// package.json
{
  "lint-staged": {
    "*.{ts,tsx,vue}": ["eslint --fix", "prettier --write"]
  }
}
```

**`.husky/pre-commit`**:

```bash
npx lint-staged
npm run typecheck
```

**ç†ç”±**:

- âœ… æäº¤å‰è‡ªåŠ¨ä¿®å¤ ESLint è­¦å‘Šå’Œæ ¼å¼é—®é¢˜
- âœ… é˜²æ­¢ä»£ç è´¨é‡å€’é€€ï¼ˆå¼ºåˆ¶ç±»å‹æ£€æŸ¥é€šè¿‡ï¼‰
- âœ… å‡å°‘ CI å¤±è´¥æ¬¡æ•°

---

### 4.3 æµ‹è¯•è¦†ç›–ï¼ˆæ¨èï¼‰

#### âœ… å•å…ƒæµ‹è¯•è¦†ç›–ç‡å·¥å…·

**é…ç½®**:

```typescript
// vitest.config.ts
export default defineConfig({
  test: {
    coverage: {
      provider: 'v8',
      reporter: ['text', 'html'],
      thresholds: {
        lines: 50, // é€æ­¥æå‡
        functions: 50,
        branches: 50,
      },
      exclude: [
        'src/content/index.ts', // å¾…æ‹†åˆ†ï¼Œæš‚ä¸æµ‹è¯•
        '**/*.spec.ts',
      ],
    },
  },
})
```

**è¿è¡Œ**:

```bash
npm run test -- --coverage
```

**ç†ç”±**:

- âœ… é‡åŒ–æµ‹è¯•è¦†ç›–ç‡ï¼Œè®¾å®šè´¨é‡é—¨
- âœ… ç”Ÿæˆ HTML æŠ¥å‘Šï¼Œå¯è§†åŒ–æœªè¦†ç›–ä»£ç 
- âœ… é€æ­¥æå‡é˜ˆå€¼ï¼ˆ50% â†’ 70% â†’ 80%ï¼‰

---

#### âœ… ç»„ä»¶æµ‹è¯•åº“

**å®‰è£…**:

```bash
npm install --save-dev @vue/test-utils
```

**ç¤ºä¾‹**:

```typescript
// tests/components/ResourceListView.spec.ts
import { mount } from '@vue/test-utils'
import ResourceListView from '@/content/components/ResourceListView.vue'

describe('ResourceListView', () => {
  it('should render empty state', () => {
    const wrapper = mount(ResourceListView, {
      props: { items: [] },
    })
    expect(wrapper.text()).toContain('æš‚æ— èµ„æº')
  })

  it('should toggle selection on click', async () => {
    const wrapper = mount(ResourceListView, {
      props: { items: [{ id: '1', title: 'Test' }] },
    })
    await wrapper.find('[data-item-id="1"]').trigger('click')
    expect(wrapper.emitted('toggle-selection')).toBeTruthy()
  })
})
```

**ç†ç”±**:

- âœ… Vue å®˜æ–¹æµ‹è¯•å·¥å…·ï¼Œä¸“ä¸º Vue ç»„ä»¶è®¾è®¡
- âœ… å·²æœ‰ Vitest + jsdomï¼Œç›´æ¥é›†æˆ
- âœ… æ”¯æŒå¼‚æ­¥æµ‹è¯•ã€äº‹ä»¶æµ‹è¯•ã€æ’æ§½æµ‹è¯•

---

### 4.4 å¼€å‘ä½“éªŒï¼ˆå¯é€‰ï¼‰

#### âœ… Vue DevToolsï¼ˆæµè§ˆå™¨æ‰©å±•ï¼‰

**å®‰è£…**: Chrome Web Store æœç´¢ "Vue.js devtools"

**ç†ç”±**:

- âœ… è°ƒè¯• Vue ç»„ä»¶çŠ¶æ€/äº‹ä»¶
- âœ… æŸ¥çœ‹ Pinia Store å®æ—¶çŠ¶æ€
- âš ï¸ éœ€åœ¨å¼€å‘æ¨¡å¼ä¸‹ç¦ç”¨ Content Script éš”ç¦»

**é…ç½®**:

```typescript
// vite.config.ts
export default defineConfig({
  define: {
    __VUE_PROD_DEVTOOLS__: true, // ç”Ÿäº§ç¯å¢ƒä¹Ÿå¯ç”¨ DevTools
  },
})
```

---

#### âœ… ESLint è‡ªåŠ¨ä¿®å¤ï¼ˆVS Codeï¼‰

**é…ç½®**:

```json
// .vscode/settings.json
{
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": "explicit"
  },
  "editor.formatOnSave": true,
  "editor.defaultFormatter": "esbenp.prettier-vscode"
}
```

**ç†ç”±**: ä¿å­˜æ—¶è‡ªåŠ¨ä¿®å¤ ESLint è­¦å‘Šå’Œæ ¼å¼é—®é¢˜

---

### 4.5 æ¶æ„é‡æ„å·¥å…·ï¼ˆä¸­é•¿æœŸï¼‰

#### ğŸ† å¼•å…¥ Composition API é‡æ„å¤§æ§åˆ¶å™¨

**ç›®æ ‡**: æ‹†åˆ† `ContentRuntime` (720 LOC â†’ < 200 LOC)

**ç¤ºä¾‹**:

```typescript
// composables/usePanel.ts
export function usePanel() {
  const store = usePanelStore()

  const createPanel = () => {
    // é¢æ¿åˆ›å»ºé€»è¾‘
  }

  const destroyPanel = () => {
    // æ¸…ç†é€»è¾‘
  }

  return { createPanel, destroyPanel, state: store }
}

// composables/useHistory.ts
export function useHistory() {
  const loadHistory = async () => {
    // å†å²è®°å½•åŠ è½½
  }

  return { loadHistory }
}

// composables/useTransfer.ts
export function useTransfer() {
  const { state } = usePanelStore()

  const startTransfer = async () => {
    const response = await chrome.runtime.sendMessage({
      type: 'chaospace:transfer',
      payload: { items: state.selectedItems },
    })
  }

  return { startTransfer }
}

// ContentRuntime.ts (é‡æ„å)
class ContentRuntime {
  panel = usePanel()
  history = useHistory()
  transfer = useTransfer()

  async initialize() {
    this.panel.createPanel()
    await this.history.loadHistory()
  }
}
```

**ä¼˜åŠ¿**:

- âœ… é€»è¾‘æŒ‰åŠŸèƒ½æ‹†åˆ†ï¼Œå•ä¸€èŒè´£
- âœ… æ˜“äºæµ‹è¯•ï¼Œå¯ç‹¬ç«‹è¿è¡Œ
- âœ… å¯å¤ç”¨ï¼ˆå¦‚ Settings Modal ä¹Ÿéœ€è¦ `useHistory()`ï¼‰
- âœ… ä»£ç å¯è¯»æ€§æå‡ 50%+

**è¿ç§»æˆæœ¬**: ä¸­ç­‰ï¼ˆ5-7 å¤©ï¼‰

---

## 5. ä¸å»ºè®®å¼•å…¥çš„å·¥å…·

### âŒ Vuex

**ç†ç”±**:

- è¢« Pinia å–ä»£ï¼ŒVue å®˜æ–¹å·²ä¸æ¨è
- æ ·æ¿ä»£ç å¤šï¼ŒTypeScript æ”¯æŒå·®
- å­¦ä¹ æˆæœ¬é«˜

---

### âŒ CSS é¢„å¤„ç†å™¨ï¼ˆLess/Sassï¼‰

**ç†ç”±**:

- é¡¹ç›®å·²ä½¿ç”¨ **PostCSS Nesting**ï¼Œæ»¡è¶³åµŒå¥—éœ€æ±‚
- å¼•å…¥ä¼šå¢åŠ æ„å»ºå¤æ‚åº¦
- ç°ä»£æµè§ˆå™¨å·²åŸç”Ÿæ”¯æŒ CSS åµŒå¥—

**å½“å‰æ–¹æ¡ˆå·²è¶³å¤Ÿ**:

```css
/* âœ… PostCSS Nesting */
.panel {
  background: white;

  & .header {
    font-size: 16px;
  }

  &.dark {
    background: black;
  }
}
```

---

### âŒ UI ç»„ä»¶åº“ï¼ˆElement Plus/Ant Design Vueï¼‰

**ç†ç”±**:

- æµè§ˆå™¨æ‰©å±•éœ€**è½»é‡åŒ–**ï¼Œå¼•å…¥å¤§å‹åº“ä¼šæ‹–æ…¢åŠ è½½ï¼ˆ100KB+ gzippedï¼‰
- æ‰©å±• UI æ ·å¼éœ€é«˜åº¦å®šåˆ¶ï¼Œç»„ä»¶åº“åè€Œæˆä¸ºé™åˆ¶
- å½“å‰è‡ªå®šä¹‰æ ·å¼å·²è¶³å¤Ÿï¼ˆåˆ†å±‚ CSS æ¶æ„æ¸…æ™°ï¼‰

**å»ºè®®**: ç»§ç»­ä¿æŒè‡ªå®šä¹‰ç»„ä»¶

---

### âŒ RxJS

**ç†ç”±**:

- å­¦ä¹ æ›²çº¿é™¡å³­ï¼Œå›¢é˜Ÿæˆå‘˜éœ€åŸ¹è®­
- å½“å‰é¡¹ç›®å¼‚æ­¥é€»è¾‘ä¸å¤æ‚ï¼Œ`async/await` å·²è¶³å¤Ÿ
- å¼•å…¥ä¼šå¢åŠ  Bundle Sizeï¼ˆ~30KBï¼‰

---

### âŒ Lodash

**ç†ç”±**:

- ç°ä»£ ES6+ å·²æä¾›å¤§éƒ¨åˆ†å·¥å…·å‡½æ•°
- å¯æŒ‰éœ€å¼•å…¥å•ä¸ªå‡½æ•°ï¼Œé¿å…å…¨é‡å¼•å…¥

**ç¤ºä¾‹**:

```typescript
// âŒ ä¸æ¨è
import _ from 'lodash'
_.uniq(arr)

// âœ… æ¨è
const uniq = <T>(arr: T[]) => [...new Set(arr)]
```

---

## 6. ä¼˜åŒ–è·¯çº¿å›¾

### é˜¶æ®µ 1: ä¿®å¤ç±»å‹å®‰å…¨ï¼ˆ1-2 å¤©ï¼‰

**ç›®æ ‡**: æ¶ˆé™¤ TypeScript ç±»å‹è­¦å‘Šï¼Œå¯ç”¨ä¸¥æ ¼æ¨¡å¼

**ä»»åŠ¡**:

- [ ] ä¸º Chrome æ¶ˆæ¯ payload æ·»åŠ ä¸¥æ ¼ç±»å‹å®ˆå«

  ```typescript
  // âœ… ç¤ºä¾‹
  interface TransferMessage {
    type: 'chaospace:transfer'
    payload: TransferPayload
  }

  chrome.runtime.onMessage.addListener((msg: unknown) => {
    if (isTransferMessage(msg)) {
      console.log(msg.payload.items) // âœ… ç±»å‹å®‰å…¨
    }
  })
  ```

- [ ] ä¿®å¤æ‰€æœ‰ `@typescript-eslint/no-unsafe-*` è­¦å‘Šï¼ˆ~400 æ¡ï¼‰
- [ ] ç§»é™¤ `skipManifestValidation`ï¼Œä¿®å¤ manifest é—®é¢˜
- [ ] ä¿®å¤æœªä½¿ç”¨å˜é‡ï¼ˆ`_error` â†’ ç§»é™¤æˆ–ä½¿ç”¨ï¼‰

**æˆåŠŸæ ‡å‡†**: `npm run lint` è¾“å‡º 0 warnings

**é¢„æœŸæ”¶ç›Š**: å‡å°‘ 40% è¿è¡Œæ—¶ç±»å‹é”™è¯¯

---

### é˜¶æ®µ 2: å¼•å…¥ Piniaï¼ˆ3-5 å¤©ï¼‰

**ç›®æ ‡**: è¿ç§»å…¨å±€ state åˆ° Pinia Store

**ä»»åŠ¡**:

- [ ] å®‰è£… Pinia: `npm install pinia`
- [ ] åˆ›å»º `src/content/stores/` ç›®å½•
- [ ] æ‹†åˆ† Store:
  - `stores/panel.ts` - é¢æ¿çŠ¶æ€ï¼ˆitemsã€selectedIdsã€baseDirã€themeï¼‰
  - `stores/history.ts` - å†å²è®°å½•çŠ¶æ€
  - `stores/transfer.ts` - è½¬å­˜è¿›åº¦çŠ¶æ€
- [ ] æ”¹é€  Vue ç»„ä»¶ä½¿ç”¨ `usePanelStore()`
- [ ] ç§»é™¤æ‰‹åŠ¨ `renderResourceList()` è°ƒç”¨
- [ ] ç§»é™¤ `src/content/state/index.ts`

**æˆåŠŸæ ‡å‡†**:

- âœ… æ‰€æœ‰ Vue ç»„ä»¶ä½¿ç”¨ Pinia Store
- âœ… æ— æ‰‹åŠ¨ DOM æ›´æ–°ä»£ç 
- âœ… Vue DevTools å¯æŸ¥çœ‹çŠ¶æ€

**é¢„æœŸæ”¶ç›Š**: ä»£ç é‡å‡å°‘ 30%ï¼ŒBug ç‡é™ä½ 40%

---

### é˜¶æ®µ 3: æ‹†åˆ†å¤§æ§åˆ¶å™¨ï¼ˆ5-7 å¤©ï¼‰

**ç›®æ ‡**: å°† `ContentRuntime` (720 LOC) æ‹†åˆ†ä¸º Composables

**ä»»åŠ¡**:

- [ ] æå– `composables/usePanel.ts` - é¢æ¿ç”Ÿå‘½å‘¨æœŸç®¡ç†
- [ ] æå– `composables/useHistory.ts` - å†å²è®°å½•åŠ è½½
- [ ] æå– `composables/useTransfer.ts` - è½¬å­˜æµç¨‹
- [ ] æå– `composables/usePreferences.ts` - åå¥½è®¾ç½®/è·¯å¾„ç®¡ç†
- [ ] æå– `composables/useLogging.ts` - æ—¥å¿—ç®¡ç†
- [ ] `ContentRuntime` ç²¾ç®€è‡³ < 200 LOCï¼ˆä»…ä¿ç•™åˆå§‹åŒ–/é”€æ¯é€»è¾‘ï¼‰

**æˆåŠŸæ ‡å‡†**:

- âœ… `ContentRuntime` < 200 LOC
- âœ… æ¯ä¸ª Composable èŒè´£å•ä¸€ï¼ˆ< 100 LOCï¼‰
- âœ… æ‰€æœ‰ Composable æœ‰å¯¹åº”å•å…ƒæµ‹è¯•

**é¢„æœŸæ”¶ç›Š**: ä»£ç å¯è¯»æ€§æå‡ 50%ï¼Œæ˜“äºæµ‹è¯•

---

### é˜¶æ®µ 4: æå‡æµ‹è¯•è¦†ç›–ï¼ˆæŒç»­ï¼‰

**ç›®æ ‡**: å°†æµ‹è¯•è¦†ç›–ç‡ä» < 10% æå‡è‡³ 50%+

**ä»»åŠ¡**:

- [ ] å®‰è£… `@vue/test-utils`: `npm install --save-dev @vue/test-utils`
- [ ] é…ç½®è¦†ç›–ç‡å·¥å…·ï¼ˆVitest coverageï¼‰
- [ ] ä¸ºæ ¸å¿ƒç»„ä»¶æ·»åŠ æµ‹è¯•:
  - `ResourceListView.spec.ts` - èµ„æºåˆ—è¡¨äº¤äº’
  - `HistoryListView.spec.ts` - å†å²è®°å½•å±•ç¤º
  - `PanelRoot.spec.ts` - é¢æ¿ä¸»æµç¨‹
- [ ] ä¸º Composables æ·»åŠ æµ‹è¯•:
  - `usePanel.spec.ts`
  - `useHistory.spec.ts`
  - `useTransfer.spec.ts`
- [ ] ä¸ºæ ¸å¿ƒæœåŠ¡æ·»åŠ æµ‹è¯•:
  - `transfer-service.spec.ts` - è½¬å­˜æµç¨‹
  - `history-service.spec.ts` - å†å²è®°å½•ç®¡ç†
- [ ] å¢åŠ  E2E æµ‹è¯•åœºæ™¯:
  - å®Œæ•´è½¬å­˜æµç¨‹
  - å†å²è®°å½•å¢é‡æ›´æ–°
  - é”™è¯¯å¤„ç†ï¼ˆç½‘ç»œå¤±è´¥ã€ç™»å½•å¤±æ•ˆï¼‰

**æˆåŠŸæ ‡å‡†**:

- âœ… æµ‹è¯•è¦†ç›–ç‡ > 50%
- âœ… æ ¸å¿ƒä¸šåŠ¡é€»è¾‘è¦†ç›–ç‡ > 70%
- âœ… E2E æµ‹è¯•è¦†ç›–å…³é”®ç”¨æˆ·è·¯å¾„

**é¢„æœŸæ”¶ç›Š**: å›å½’ Bug å‡å°‘ 60%

---

### é˜¶æ®µ 5: è´¨é‡ä¿éšœï¼ˆæŒç»­ï¼‰

**ç›®æ ‡**: å»ºç«‹è‡ªåŠ¨åŒ–è´¨é‡é—¨ï¼Œé˜²æ­¢ä»£ç è´¨é‡å€’é€€

**ä»»åŠ¡**:

- [ ] é…ç½® Git Hooksï¼ˆhusky + lint-stagedï¼‰
- [ ] è®¾ç½® ESLint è­¦å‘Šä¸Šé™ï¼ˆä¸å…è®¸æ–°å¢è­¦å‘Šï¼‰
  ```json
  // package.json
  {
    "scripts": {
      "lint": "eslint . --max-warnings 0"
    }
  }
  ```
- [ ] é…ç½® CIï¼ˆGitHub Actionsï¼‰:
  - è¿è¡Œ `npm run check`
  - ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
  - é˜»æ­¢è¦†ç›–ç‡ä¸‹é™çš„ PR
- [ ] æ–‡æ¡£åŒ– Composable APIï¼ˆåœ¨ `CLAUDE.md` ä¸­è¡¥å……ä½¿ç”¨ç¤ºä¾‹ï¼‰

**æˆåŠŸæ ‡å‡†**:

- âœ… Git Hook åœ¨æäº¤å‰è‡ªåŠ¨ä¿®å¤æ ¼å¼/lint é—®é¢˜
- âœ… CI é€šè¿‡ç‡ > 95%
- âœ… æ–° PR æ— æ–°å¢ ESLint è­¦å‘Š

---

## 7. æŠ•å…¥äº§å‡ºåˆ†æ

### 7.1 ä¼˜åŒ–æ”¶ç›ŠçŸ©é˜µ

| ä¼˜åŒ–é¡¹       | æŠ•å…¥æ—¶é—´ | ä»£ç å‡å°‘ | Bug å‡å°‘ | å¯ç»´æŠ¤æ€§æå‡ | ä¼˜å…ˆçº§     |
| ------------ | -------- | -------- | -------- | ------------ | ---------- |
| å¼•å…¥ Pinia   | 3-5 å¤©   | -30%     | -40%     | +50%         | ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ |
| ä¿®å¤ç±»å‹è­¦å‘Š | 1-2 å¤©   | 0%       | -40%     | +30%         | ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ |
| æ‹†åˆ†å¤§æ§åˆ¶å™¨ | 5-7 å¤©   | -20%     | -30%     | +50%         | ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥   |
| æå‡æµ‹è¯•è¦†ç›– | æŒç»­     | 0%       | -60%     | +40%         | ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥   |
| Git Hooks    | 1 å¤©     | 0%       | -20%     | +20%         | ğŸ”¥ğŸ”¥ğŸ”¥     |

### 7.2 æ€»ä½“æ”¶ç›Š

**æ€»æŠ•å…¥**: 15-20 å·¥ä½œæ—¥
**é¢„æœŸæ”¶ç›Š**:

- ä»£ç é‡å‡å°‘: **30%** (ç§»é™¤æ‰‹åŠ¨ DOM æ›´æ–°ã€é‡å¤é€»è¾‘)
- Bug ç‡é™ä½: **50%** (ç±»å‹å®‰å…¨ + å“åº”å¼ + æµ‹è¯•è¦†ç›–)
- å¼€å‘æ•ˆç‡æå‡: **40%** (Vue DevTools + æ¨¡å—åŒ– + è‡ªåŠ¨åŒ–)
- æ–°æˆå‘˜ä¸Šæ‰‹æ—¶é—´: **ä» 2 å‘¨ç¼©çŸ­è‡³ 3 å¤©**

### 7.3 é£é™©è¯„ä¼°

**ä½é£é™©**:

- âœ… æ‰€æœ‰æ¨èå·¥å…·å‡ä¸º Vue å®˜æ–¹/ç¤¾åŒºæˆç†Ÿæ–¹æ¡ˆ
- âœ… å¯å¢é‡è¿ç§»ï¼Œä¸å½±å“ç°æœ‰åŠŸèƒ½
- âœ… æ¯ä¸ªé˜¶æ®µå¯ç‹¬ç«‹éªŒè¯

**æ½œåœ¨é£é™©**:

- âš ï¸ Pinia è¿ç§»å¯èƒ½é—æ¼è¾¹ç•Œæƒ…å†µï¼ˆç¼“è§£ï¼šå……åˆ†æµ‹è¯•ï¼‰
- âš ï¸ Composables æ‹†åˆ†å¯èƒ½å¼•å…¥æ–°çš„æŠ½è±¡å±‚ï¼ˆç¼“è§£ï¼šä¿æŒç®€å•ï¼Œé¿å…è¿‡åº¦å·¥ç¨‹ï¼‰

---

## 8. é™„å½•

### 8.1 ESLint è­¦å‘Šåˆ†å¸ƒï¼ˆTop 10 æ–‡ä»¶ï¼‰

| æ–‡ä»¶                                       | è­¦å‘Šæ•°   | ä¸»è¦é—®é¢˜                    |
| ------------------------------------------ | -------- | --------------------------- |
| `src/content/index.ts`                     | 144      | unsafe any æ“ä½œã€æœªä½¿ç”¨å˜é‡ |
| `src/content/components/resource-list.ts`  | 22       | unsafe anyã€å¤šç»„ä»¶å•æ–‡ä»¶    |
| `src/background/api/baidu-pan.ts`          | 18       | unsafe anyã€æœªä½¿ç”¨å˜é‡      |
| `src/content/components/settings-modal.ts` | 14       | unsafe anyã€to-string é—®é¢˜  |
| `src/content/history/controller.ts`        | 5        | unsafe any                  |
| `src/content/components/history-card.ts`   | 2        | å¤šç»„ä»¶å•æ–‡ä»¶                |
| å…¶ä»–æ–‡ä»¶                                   | 195      | å„ç±»è­¦å‘Š                    |
| **æ€»è®¡**                                   | **~400** |                             |

### 8.2 æ¨èå­¦ä¹ èµ„æº

- [Pinia å®˜æ–¹æ–‡æ¡£](https://pinia.vuejs.org/)
- [Vue 3 Composition API æŒ‡å—](https://vuejs.org/guide/extras/composition-api-faq.html)
- [TypeScript Handbook](https://www.typescriptlang.org/docs/handbook/intro.html)
- [@vue/test-utils æ–‡æ¡£](https://test-utils.vuejs.org/)
- [Vitest æ–‡æ¡£](https://vitest.dev/)

---

## 9. æ€»ç»“

æœ¬é¡¹ç›®å·²å®Œæˆç°ä»£åŒ–æŠ€æœ¯æ ˆè¿ç§»çš„ç¬¬ä¸€é˜¶æ®µï¼ˆVite + Vue 3 + TypeScriptï¼‰ï¼Œ**ä¸‹ä¸€æ­¥åº”èšç„¦äºçŠ¶æ€ç®¡ç†ç°ä»£åŒ–å’Œç±»å‹å®‰å…¨å½»åº•åŒ–**ã€‚

**æ ¸å¿ƒå»ºè®®**:

1. **ç«‹å³è¡ŒåŠ¨**: ä¿®å¤ TypeScript ç±»å‹è­¦å‘Šï¼ˆ1-2 å¤©ï¼Œé«˜æ”¶ç›Šä½æˆæœ¬ï¼‰
2. **é‡ç‚¹çªç ´**: å¼•å…¥ Pinia æ›¿æ¢å…¨å±€ stateï¼ˆ3-5 å¤©ï¼Œè§£å†³æœ€å¤§ç—›ç‚¹ï¼‰
3. **é•¿æœŸä¼˜åŒ–**: æ‹†åˆ† ContentRuntime + æå‡æµ‹è¯•è¦†ç›–ï¼ˆæŒç»­æ”¹è¿›ï¼‰

é€šè¿‡ä»¥ä¸Šä¼˜åŒ–ï¼Œé¡¹ç›®å°†ä» **3.5/5 æå‡è‡³ 4.5/5**ï¼Œæ˜¾è‘—é™ä½ç»´æŠ¤æˆæœ¬å’Œ Bug ç‡ã€‚

---

**ç”Ÿæˆå·¥å…·**: Claude Code
**æŠ¥å‘Šç‰ˆæœ¬**: 1.0
**æœ€åæ›´æ–°**: 2025-11-05
